#!/usr/bin/env python3
"""
åˆ—å‡ºæ‰€æœ‰batch

ç”¨æ³•:
    python list_batches.py
    python list_batches.py --verbose
"""

import argparse
import sys
from pathlib import Path

# æ·»åŠ çˆ¶ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, str(Path(__file__).parent.parent))

from experiment_manager_batch import BatchExperimentManager

PROJECT_ROOT = "/home/ubuntu/LLM-inference/jikai-project/Synthetic_Data_for_ZO"


def main():
    parser = argparse.ArgumentParser(
        description='åˆ—å‡ºæ‰€æœ‰batchå®éªŒæ‰¹æ¬¡'
    )
    parser.add_argument(
        '-v', '--verbose',
        action='store_true',
        help='æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ¯ä¸ªbatchä¸­çš„å®éªŒæ•°é‡ï¼‰'
    )
    args = parser.parse_args()

    base_output_dir = Path(PROJECT_ROOT) / "Data_v2" / "synthetic"
    manager = BatchExperimentManager(base_output_dir)

    batches = manager.list_batches()

    if not batches:
        print("æœªæ‰¾åˆ°ä»»ä½•batch")
        return 0

    print("\n" + "=" * 80)
    print(f"æ‰¾åˆ° {len(batches)} ä¸ªbatch")
    print("=" * 80)

    for batch_id in batches:
        print(f"\nğŸ“¦ {batch_id}")

        if args.verbose:
            # è·å–è¯¥batchä¸­çš„å®éªŒ
            experiments = manager.list_experiments_in_batch(batch_id)
            if experiments:
                datasets = {}
                for exp in experiments:
                    dataset = exp['dataset']
                    if dataset not in datasets:
                        datasets[dataset] = []
                    datasets[dataset].append(exp['exp_name'])

                print(f"   å®éªŒæ•°: {len(experiments)}")
                for dataset, exp_names in datasets.items():
                    print(f"   {dataset}: {len(exp_names)} ä¸ªå®éªŒ")
                    for name in exp_names:
                        print(f"      - {name}")
            else:
                print("   (ç©ºbatch)")

    print()
    return 0


if __name__ == '__main__':
    exit(main())
