# å®Œæ•´çš„Copaåˆæˆæ•°æ®ç”Ÿæˆé…ç½®ç¤ºä¾‹
# åŒ…å«å®éªŒç®¡ç† + MeZOæ•°æ®é›†ç»“æ„

# ========== å®éªŒç®¡ç†ï¼ˆBatchæ–¹æ¡ˆ3++ï¼‰ ==========
experiment:
  # Batch ID - ç”¨äºç»„ç»‡å¤šä¸ªå®éªŒåˆ°åŒä¸€æ‰¹æ¬¡ï¼ˆå¯é€‰ï¼‰
  # æ ¼å¼: batch_{date}_{purpose}
  # å¦‚æœä¸æŒ‡å®šï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ: batch_{YYYYMMDD}_{purpose}
  batch_id: "batch_20241229_temperature"  # å¯é€‰ï¼Œä¸å¡«åˆ™è‡ªåŠ¨ç”Ÿæˆ

  purpose: "prompt_engineering"  # å®éªŒç›®çš„ï¼ˆç”¨äºè‡ªåŠ¨ç”Ÿæˆbatch_idï¼‰
  description: "Copaä»»åŠ¡çš„promptä¼˜åŒ–å®éªŒ"
  experiment_id: "copa_mezo_v1"  # å®éªŒæ ‡è¯†ï¼ˆå·²åºŸå¼ƒï¼Œä¿ç•™å…¼å®¹æ€§ï¼‰
  overwrite_strategy: "prompt"  # ç›¸åŒå‚æ•°æ—¶æç¤ºæ˜¯å¦è¦†ç›–ï¼ˆå·²åºŸå¼ƒï¼ŒBatchæ–¹æ¡ˆè‡ªåŠ¨å»é‡ï¼‰

# ========== åŸºæœ¬ä¿¡æ¯ ==========
task_name: "Copa"
training_method: "mezo"
version: "v1"

# ========== æ•°æ®é›†é…ç½® ==========
dataset:
  task_name: "copa"  # å°å†™ï¼Œç”¨äºæ–‡ä»¶å‘½å
  dataset_name: "Copa"  # ğŸ”§ å¤§å†™ï¼Œç”¨äºç›®å½•å‘½åï¼ˆMeZOæœŸæœ›çš„ï¼‰
  input_path: "Data/original/Copa/copa_train.jsonl"

  # ğŸ”§ åŸå§‹æ•°æ®é›†ç›®å½•ï¼ˆç”¨äºå¤åˆ¶validation/testï¼‰
  original_dir: "Data/original/Copa"

  # ğŸ”§ æ•°æ®é›†æ–‡ä»¶åˆ—è¡¨
  files:
    train: "copa_train.jsonl"
    validation: "copa_validation.jsonl"
    test: "copa_test.jsonl"

  fields:
    - "premise"
    - "choice1"
    - "choice2"
    - "question"
    - "label"

# ========== ç”Ÿæˆé…ç½® ==========
generation:
  # â­ Rewriter APIé…ç½®
  api_key: "sk-eWSYPo0CvhRYgcJs55B0C3F00aC74f6e95F47c1f4772292c"
  base_url: "https://api2.aigcbest.top/v1"
  timeout: 120

  model: "gpt-4o"
  temperature: 0.9
  field_to_rephrase: "premise"  # â­ æŒ‡å®šè¦æ”¹å†™çš„å­—æ®µ

  # â­ Rephrase Prompt - æ”¯æŒPlaceholderå’Œå­—æ®µå¼•ç”¨
  # - {{REPHRASE_FEWSHOT}}: ç³»ç»Ÿä¼šè‡ªåŠ¨æ’å…¥few-shot examplesï¼ˆæ¥è‡ªæ–­ç‚¹1å®¡æ ¸é€šè¿‡çš„æ ·æœ¬ï¼‰
  # - {field_name}: ä½¿ç”¨Python .format()è¯­æ³•å¼•ç”¨å­—æ®µå€¼
  rephrase_prompt: |
    You are tasked with rephrasing the given premise while preserving its original meaning. Your goal is to create rephrased data optimized for enhancing gradient estimation in training with a memory-efficient zeroth-order optimizer (MeZO).

    {{REPHRASE_FEWSHOT}}

    ### Key Requirements for Premise Rephrasing:
    1. **Task-Specific Context**:
       - The **Copa dataset** focuses on **causal reasoning**, where the goal is to determine the **cause or effect** of a given premise.
       - The rephrased **premise** must **not alter the logical relationship** with the correct choice.

    2. **Consistency with Correct Answer**:
       - Ensure that the rephrased premise maintains the same correct answer as the original.
       - The correct answer is: Choice {label + 1}: "{choice1 if label == 0 else choice2}"

    3. **Optimized for MeZO Training**:
       - **Enhance Gradient Sensitivity**: Create clear semantic boundaries to increase gradient sensitivity.
       - **Focus on Memory Efficiency**: Reduce redundancy, keep sentences concise.
       - **Robustness to Data Sparsity**: Ensure essential information is preserved.
       - **Non-Differentiable Optimization Readiness**: Create clear impacts on performance metrics.

    4. **Maintain Neutral Stance**:
       - Do not explicitly indicate which choice is correct.
       - The rephrased premise should require reasoning to determine the answer.

    5. **High-Quality Data Generation**:
       - Produce natural, fluent, and coherent text.
       - Use paraphrasing, synonyms, or restructuring to diversify data.

    ### Your Task:
    Rephrase the following premise while ensuring it remains consistent with the correct answer.

    **Original premise**: "{premise}"
    **Choice 1**: "{choice1}"
    **Choice 2**: "{choice2}"
    **Question**: "{question}"
    **Correct answer**: "{choice1 if label == 0 else choice2}"

    **Directly output only one rephrased premise** without any other characters or explanatory statements:

# ========== éªŒè¯é…ç½® ==========
validation:
  # â­ Judge APIé…ç½®
  api_key: "sk-eWSYPo0CvhRYgcJs55B0C3F00aC74f6e95F47c1f4772292c"
  base_url: "https://api2.aigcbest.top/v1"
  timeout: 120

  model: "gpt-4o"
  temperature: 0.0

  # â­ Validation Prompt - æ”¯æŒPlaceholderå’Œå­—æ®µå¼•ç”¨
  # - {{VALIDATION_FEWSHOT}}: ç³»ç»Ÿä¼šè‡ªåŠ¨æ’å…¥few-shot examplesï¼ˆæ¥è‡ªæ–­ç‚¹2Aå®¡æ ¸é€šè¿‡çš„21-40æ ·æœ¬ï¼‰
  # - {original_field}, {rephrased_field}: ä½¿ç”¨Python .format()è¯­æ³•å¼•ç”¨å­—æ®µå€¼
  validation_prompt: |
    Task: Verify if the rephrased premise maintains consistency with the correct answer choice.

    {{VALIDATION_FEWSHOT}}

    Original premise: "{original_premise}"
    Rephrased premise: "{rephrased_premise}"
    Choice 1: "{original_choice1}"
    Choice 2: "{original_choice2}"
    Question: "{original_question}"
    Correct answer: "{original_choice1 if original_label == 0 else original_choice2}"

    Output [same/not the same]:

  # â­ Few-shot examples - åˆå§‹å¯ç•™ç©ºï¼Œç³»ç»Ÿä¼šåœ¨æ–­ç‚¹2Aåè‡ªåŠ¨ç”Ÿæˆ
  few_shot_examples:
    - original_premise: "My body cast a shadow over the grass."
      rephrased_premise: "A shadow from my body fell across the grass."
      choice1: "The sun was rising."
      choice2: "The grass was cut."
      question: "cause"
      label: 0
      evaluation: "same"

    - original_premise: "The woman tolerated her friend's difficult behavior."
      rephrased_premise: "The woman accepted her friend's challenging conduct."
      choice1: "The woman knew her friend was going through a hard time."
      choice2: "The woman felt that her friend took advantage of her kindness."
      question: "cause"
      label: 0
      evaluation: "same"

    - original_premise: "The women met for coffee."
      rephrased_premise: "The two women decided to gather at a cafÃ©."
      choice1: "The cafe reopened in a new location."
      choice2: "They wanted to catch up with each other."
      question: "cause"
      label: 1
      evaluation: "same"
